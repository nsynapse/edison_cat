
{%load staticfiles %}
<div class="row">
	<div id="connection" class="pad margin no-print">
	</div>
</div>
    
<div class="row">

	<div class="col-md-12">
		<div class="box">
			<div class="box-header">
				<h3 class="box-title">Touch Sensors</h3>
				<div class="box-tools pull-right">
					<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
					<button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body no-padding">
				<table class="table table-striped">
				<tr>
					<th style="width: 10px">ID</th>
					<th>Name</th>
					<th style="width: 50px"></th>
				</tr>
				<tr>
				  <td>1</td>
				  <td>Front Head</td>
				  <td id="touch_1"><span class="badge bg-black">Touch</span></td>
				</tr>
				<tr>
				  <td>2</td>
				  <td>Rear Head</td>
				  <td id="touch_2"><span class="badge bg-black">Touch</span></td>
				</tr>
				<tr>
				  <td>3</td>
				  <td>Nose</td>
				  <td id="touch_3"><span class="badge bg-black">Touch</span></td>
				</tr>
				<tr>
				  <td>4</td>
				  <td>Left Ear</td>
				  <td id="touch_4"><span class="badge bg-black">Touch</span></td>
				</tr>
				<tr>
				  <td>5</td>
				  <td>Right Ear</td>
				  <td id="touch_5"><span class="badge bg-black">Touch</span></td>
				</tr>
				</table>
			</div>
			<!-- /.box-body -->
		</div>
	<!-- /.box -->
	</div><!-- /.col -->
</div><!-- /.row -->
	
<!--  <script type="text/javascript" src="{% static 'js/vendor/dygraph/dygraph-combined.js' %}"></script>-->
<script type="text/javascript">

//web socket server connection
$(document).ready(function(){

	
	var socket_uri = "ws://192.168.0.6:9002/sensor/"
	var sock = new WebSocket(socket_uri)
	
	sock.onopen = function(){
		console.log("connection to " + socket_uri);
		//$('#connection').html("<div class='alert alert-success alert-dismissible'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button><h4><i class='icon fa fa-check'></i> Alert!</h4>Successfully connected to the "+socket_uri+"</div>");
		$('#connection').html("<div class='callout callout-success' style='margin-bottom: 0!important;'><h4><i class='fa fa-info'></i> Success:</h4> Successfully connected to the server "+socket_uri+".</div></div>");
		
	}
	sock.onclose = function(e){
		console.log("connection closed(" + e.code + ")")
		$('#connection').html("<div class='callout callout-danger' style='margin-bottom: 0!important;'><h4><i class='fa fa-ban'></i> Fail:</h4>Alert!"+socket_uri+" connection is failed.</div></div>");
	}
	sock.onmessage = function(e){
		var jsondata = jQuery.parseJSON(e.data);
		
		switch(jsondata.data.status){
		case 1:	//update
			if(jsondata.data.value==255) 
				$('#touch_'+jsondata.data.id.toString()).html("<span class='badge bg-red'>Touch</span>"); 
			else
				$('#touch_'+jsondata.data.id.toString()).html("<span class='badge bg-black'>Touch</span>");
		break;
		}
		
	}
});

</script>