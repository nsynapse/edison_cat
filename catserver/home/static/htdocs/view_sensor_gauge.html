
{%load staticfiles %}
{% if sensors.count > 0 %}
	<div class="row">
	{% for sensor in sensors %}
			<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
				<div class="box">
					<div class="box-header">
						<i class="fa fa-bar-chart-o"></i>
						<h3 class="box-title">{{sensor.name}}</h3>
						<div class="box-tools pull-right">
							<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
							<button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
						</div>
					</div>
					<!-- /.box-header -->
					<div class="box-body no-padding">
					<div class="row">
		                <div class="col-xs-12" align="center">
		                  <div id="{{sensor.uid}}" style="width:180px; height:150px;"></div>
		                </div>
					</div>
						
					</div>
					<!-- /.box-body -->
					<div class="box-footer no-padding">
						<a href="javascript:void(0);" class="btn btn-sm btn-warning btn-flat pull-left" onclick="camera_capture();"><i class="fa fa-play"></i> Log Start</a>
						<a href="javascript:void(0);" class="btn btn-sm btn-flat pull-right">Log View <i class="fa fa-angle-right"></i></a>
	
					</div><!-- /.box-footer -->
				</div>
			<!-- /.box -->
			</div><!-- /.col -->
		{% endfor %}
		</div>
{% endif %}

<script type="text/javascript">

$(document).ready(function(){
	
	var sensors = {}
	{% for sensor in sensors %}
		sensors[{{forloop.counter}}] = new JustGage({
			id: "{{sensor.uid}}", 
			value: 0, 
			min: {{sensor.min}},
			max: {{sensor.max}},
			titleFontColor:"#0f0f0f",
			gaugeWidthScale:0.4,
			levelColorsGradient:true,
			refreshAnimationType:"linear",
			refreshAnimationTime:1,
			startAnimationType:"linear",
			startAnimationTime:1,
			labelFontColor:"#000000",
			gaugeColor:"#eeeeee",
			valueFontColor:"#000000",
			label: "{{sensor.unit}}"
		});
	{% endfor %}
	
	var socket_uri = "ws://{{system.0.net_address}}:{{system.0.websocket_port}}/sensor"
	var sock = new WebSocket(socket_uri)
	
	sock.onopen = function(){
		console.log("connection to " + socket_uri);
		$('#connection').html("<div class='callout callout-success' style='margin-bottom: 0!important;'><h4><i class='fa fa-info'></i> Success:</h4> Successfully connected to the server "+socket_uri+".</div></div>");
		
	}
	sock.onclose = function(e){
		console.log("connection closed(" + e.code + ")")
		$('#connection').html("<div class='callout callout-danger' style='margin-bottom: 0!important;'><h4><i class='fa fa-ban'></i> Fail:</h4>Alert!"+socket_uri+" connection is failed.</div></div>");
	}
	sock.onmessage = function(e){
		var jsondata = jQuery.parseJSON(e.data);
		
		if(jsondata.id>0)
			sensors[jsondata.id].refresh(jsondata.value);
		
	}

});

</script>
